Problem: nginx 500 -- sockets not created

Sympton: nginx returns error 500 when php is activated, and no wake socket is created by systemd in /var/run/docker-apps on host

Fix: systemd needs to enable the waker service (which symlinks the socket service description into wants-socket.target) and start the waker (which creates the socket):

	systemctl enable vhost.fpm-waker.socket
	systemctl start vhost.fpm-waker.socket

If that has already been done, systemctl may be out of sync with the docker daemon. See below:




Problem: nginx 500, waker socket not created and systemd refuses to create it:

	Nov 24 11:26:05 jessie systemd[1]: Starting vhost.fpm-waker.socket.
	Nov 24 11:26:05 jessie systemd[1]: Socket service vhost.fpm-waker.service already active, refusing.
	Nov 24 11:26:05 jessie systemd[1]: Failed to listen on vhost.fpm-waker.socket.

Fix: I use the following fish function to renew the waker:

  function renewfpm
      systemctl stop    fpm@$argv.service
      systemctl disable fpm@$argv.service
      systemctl stop    fpm-waker@$argv.service
      systemctl disable fpm-waker@$argv.service
      systemctl stop    fpm-waker@$argv.socket
      systemctl disable fpm-waker@$argv.socket
      rm -f /var/run/docker-apps/$argv/*
      systemctl enable  fpm-waker@$argv.socket
      systemctl start   fpm-waker@$argv.socket
  end

There is also a script in /usr/local/bin/renew-fpm.sh which you can run with the name of the container which accomplishes the same.

	** STATUS: Unknown what causes this issue.

Problem: containers may take some time to activate and the socket may not be ready for them

Fix: ensure sockets are handed to waitport.sh which wraps netcat to wait for the container to be ready.






Problem: Ansible gives MySQL Password error during install process

Sympton: Ansible will fail with the message:

fatal: [default]: FAILED! => {"failed": true, "msg": "the field 'args' has an invalid value, which appears to include a variable that is undefined. The error was: 'mysql_root_password' is undefined\n\nThe error appears to have been in '/home/daniel/Workspace/nfg-web/ansible/roles/sql-base/tasks/alpine-tasks-find-mysql-root-password-from-docker.yml': line 15, column 3, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n- name: Store MySQL root password to file when the root password file isn't found\n  ^ here\n"}

This is caused by the common-tasks role trying to find a MySQL password before it has been generated by the maria daemon.

If this happens, it's nothing to worry about. Just wait about 30 seconds, then run the ansible-playbook plays/system/configure-web.yml play again. If using vagrant, just type 'vagrant provision' and go make a cup of tea.