---
# Usage: ansible-playbook --extra-vars "domain=mydomain.org subdomain=mysubdomain.noflag.org.uk" add-wordpress-vhost.yml
- hosts: all
  vars_prompt:
  - name: "primary_subdomain"
    prompt: >
      *** Primary subdomain **
      ALL websites must have a primary subdomain associated with them and parked to the domain host.
      This is to ensure the website is able to stay active even if control over the top-level domain is lost or expires.
      It will be used as a unique key to identify this user's domain.
      For example, for 'example.noflag.org.uk', enter 'example'.
      Enter a primary subdomain"
    private: no
  # - name: "primary_domain"
  #   prompt: "\n\n** Primary domain **\nIf the website has a primary top-level domain associated with it you may enter it now, or press enter to use the primary subdomain. \n\nIf you do enter a value, a www. alias will automatically be added as a subdomain. \n\nEnter a primary domain for Wordpress (or press enter): "
  #   private: no
  #   default: ""
  - name: "domains"
    prompt: >
      ** Extra domains **
      If the website has alias domains of any kind, enter them now, separated by a space. 
      The first top-level domain entered will become the primary domain if relevent and a www. subdomain automatically added"
    private: no
    default: ""
  become: true
  vars:
    group_fpm: false
  roles:
  - domain-munging
  - { role: containers-on-demand, when: not group_fpm, tags: ['docker'] }
  - { role: group-php-fpm, when: group_fpm, tags: ['docker'] }
  - { role: vhost-renew, use_php: true, tags: ['vhost'] }
#  - site-diagnostics